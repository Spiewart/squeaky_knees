<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xml:lang="en">
    <channel>
        <title>{{ site_name }} Blog</title>
        <link>{{ site_url }}/blog/</link>
        <description>Latest blog posts from {{ site_name }}</description>
        <language>en-us</language>

        {% for post in blog_posts %}
        <item>
            <title>{{ post.title }}</title>
            <link>{{ site_url }}{{ post.url }}</link>
            <guid>{{ site_url }}{{ post.url }}</guid>
            <pubDate>{{ post.date|date:"r" }}</pubDate>
            {% if post.owner %}
            <author>{{ post.owner.email }} ({{ post.owner.username }})</author>
            {% endif %}
            <description>{{ post.intro }}</description>
            <content:encoded><![CDATA[
                {{ post.intro }}
                {% for block in post.body %}
                    {% if block.type == 'rich_text' %}
                        {{ block.value|safe }}
                    {% elif block.type == 'code' %}
                        <pre><code>{{ block.value.code }}</code></pre>
                    {% endif %}
                {% endfor %}
            ]]></content:encoded>
            {% if post.tagged_items.all %}
            <category>{% for tag in post.tagged_items.all %}{{ tag.tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</category>
            {% endif %}
        </item>
        {% endfor %}
    </channel>
</rss>
