{% extends "base.html" %}

{% load static %}

{% block title %}Moderate Comments{% endblock %}
{% block content %}
  <div class="container mt-4">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <h1>Moderate Comments</h1>
        <form method="get" class="my-3" role="search">
          <div class="input-group">
            <input type="text"
                   class="form-control"
                   name="query"
                   placeholder="Search pending comments..."
                   value="{{ query_string|default:'' }}"
                   autocomplete="off" />
            <button class="btn btn-outline-primary" type="submit">Search</button>
            {% if query_string %}
              <a class="btn btn-outline-secondary"
                 href="{% url 'blog:moderate_comments' %}">Clear</a>
            {% endif %}
          </div>
          {% if query_string %}<p class="text-muted mt-2 mb-0">Showing results for "{{ query_string }}".</p>{% endif %}
        </form>
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show"
                 role="alert">
              {{ message }}
              <button type="button"
                      class="btn-close"
                      data-bs-dismiss="alert"
                      aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
        {% if pending_comments %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Author</th>
                  <th>Blog Post</th>
                  <th>Comment</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for comment in pending_comments %}
                  <tr>
                    <td>
                      <strong>{{ comment.author.username }}</strong>
                    </td>
                    <td>
                      <a href="{{ comment.blog_page.url }}" target="_blank">{{ comment.blog_page.title }}</a>
                    </td>
                    <td>
                      <small>{{ comment.text|truncatewords:20 }}</small>
                    </td>
                    <td>
                      <small class="text-muted">{{ comment.created|date:"M d, Y H:i" }}</small>
                    </td>
                    <td>
                      <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="comment_id" value="{{ comment.id }}" />
                        <button type="submit"
                                name="action"
                                value="approve"
                                class="btn btn-sm btn-success">Approve</button>
                        <button type="submit"
                                name="action"
                                value="delete"
                                class="btn btn-sm btn-danger"
                                onclick="return confirm('Delete this comment?')">Delete</button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="alert alert-info">
            <p>No pending comments to moderate.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock content %}
